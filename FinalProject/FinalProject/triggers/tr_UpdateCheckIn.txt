--tr_UpdateCheckIn
--Ian Suddreth 8/1/2016

GO

IF OBJECT_ID ('tr_UpdateCheckIn', 'TR') IS NOT NULL  
   DROP TRIGGER tr_UpdateCheckIn;
    
GO 

Create Trigger tr_UpdateCheckIn ON Rental
AFTER UPDATE 
AS 

IF UPDATE(RentalCheckIn)
BEGIN

	UPDATE Rental SET RentalStatus = 'C'
	WHERE RentalID =
	(
	SELECT r.RentalID
	FROM Rental r
	JOIN (SELECT i.RentalID FROM inserted i) i
	ON i.RentalID = r.RentalID
	)
	UPDATE Rental SET RentalTotal = dbo.calculateCost((SELECT i.RentalID FROM inserted i)) WHERE RentalID = (SELECT i.RentalID FROM inserted i)
END